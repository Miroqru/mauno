"""–§–∏–ª—å—Ç—Ä—ã –±–æ—Ç–∞.

–§–∏–ª—å—Ç—Ä—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —á—Ç–æ–±—ã –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å –∏–ª–∏ –Ω–µ –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å —Å–æ–±—ã—Ç–∏—è –∫
–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º.
–í—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ –¥–ª—è –±–æ–ª–µ–µ —É–¥–æ–±–Ω–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞.
–ü–æ—Å–∫–æ–ª—å–∫—É –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –Ω–µ –≤ –æ–¥–Ω–æ–º —Ä–æ—É—Ç–µ—Ä–µ.
"""

from aiogram.filters import Filter
from aiogram.types import CallbackQuery

from maubot.uno.game import UnoGame
from maubot.uno.player import Player


class NowPlaying(Filter):
    """–§–∏–ª—å—Ç—Ä —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞.

    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –º–æ–∂–µ—Ç –ª–∏ –≤—ã–∑–≤–∞–≤—à–∏–π —Å–æ–±—ã—Ç–∏–µ –∏–≥—Ä–æ–∫ —Å–¥–µ–ª–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ.
    –î–∞–Ω–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∏–≥—Ä–æ–≤—ã—Ö –∫–Ω–æ–ø–∫–∞—Ö, –∫–∞–∫ –Ω–∞–ø—Ä–∏–º–µ—Ä –≤—ã–±–æ—Ä
    —Ü–≤–µ—Ç–∞, –æ–±–º–µ–Ω —Ä—É–∫–∞–º–∏ –∏–ª–∏ —Ä–µ–≤–æ–ª—å–≤–µ—Ä.
    –ß—Ç–æ–±—ã –Ω–µ –ø–æ–∑–≤–æ–ª–∏—Ç—å –¥—Ä—É–≥–∏–º –∏–≥—Ä–æ–∫–∞–º –≤–º–µ—â–∞—Ç—å—Å—è –≤ –∏–≥—Ä—É.

    –û–¥–Ω–∞–∫–æ –µ—Å–ª–∏ –ø–æ–∂–µ–ª–∞–µ—Ç–µ, —ç—Ç–æ —Ç–æ–∂–µ –º–æ–∂–Ω–æ —Ä–µ–≥—É–ª–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏ –ø–æ–º–æ—â–∏
    –∏–≥—Ä–æ–≤—ã—Ö —Ä–µ–∂–∏–º–æ–≤.
    """

    async def __call__(
        self,
        query: CallbackQuery,
        game: UnoGame | None,
        player: Player | None
    ) -> bool:
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ —Ç–µ–∫—É—â–∏–π –∏–≥—Ä–æ–∫ –∏–º–µ–µ—Ç –ø—Ä–∞–≤–æ —Å–¥–µ–ª–∞—Ç—å —Ö–æ–¥."""
        if game is None or player is None:
            await query.answer("üçâ –ê –≤—ã —Ç–æ—á–Ω–æ —Å–µ–π—á–∞—Å –∏–≥—Ä–∞–µ—Ç–µ?")
            return False

        if game.player == player:
            return True
        elif game.rules.ahead_of_curve:
            return True
        await query.answer("üçâ –ê –≤—ã —Ç–æ—á–Ω–æ —Å–µ–π—á–∞—Å —Ö–æ–¥–∏—Ç–µ?")
        return False

